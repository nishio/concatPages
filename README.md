# concatPages

## 概要
このコードは、Scrapboxのプロジェクト内ページに関連するリンク（1hopリンク、2hopリンク、プロジェクトリンク）を取得し、モーダルダイアログ内にテキストとして表示するサンプルです。  
ユーザーインターフェイスとして、`<dialog>`タグを用いた簡易モーダルダイアログを表示し、その中に`<textarea>`で取得したページ内容を表示します。また、1hop/2hop/projの3種類のチェックボックスを設け、それぞれのチェック状態に応じて表示内容を切り替えられるようになっています。

## 特徴
- `Scrapbox API`を利用して指定ページの関連リンク（1hop、2hop、proj）を取得します。
- 初回ロード時に全ての関連リンク先ページ本文を取得し、結果をキャッシュします。  
  これにより、チェックボックス切り替え時は再度フェッチすることなく瞬時に表示内容を更新できます。
- `<dialog>`要素と`<textarea>`を使うことで、簡易的なモーダルダイアログとテキスト出力インターフェイスを実現しています。

## 前提条件
- Scrapboxのプロジェクトページ上で実行されることを想定しています（`scrapbox.Project.name`および`scrapbox.Page.title`を利用）。
- ブラウザ上でDialog APIが利用可能であること。

## 使い方
1. 本コードをScrapboxのカスタムスクリプト領域（`Custom script`）やブラウザコンソール等から実行します。  
2. 実行後、ダイアログが表示され、テキストエリア内にリンク先ページの内容が表示されます。
3. ダイアログ上部の3つのチェックボックス(1hop, 2hop, proj)を切り替えると、テキストエリアの内容がチェック状態に応じて変更されます。
4. 「閉じる」ボタンをクリックするとダイアログが閉じます。

## コードの流れ
1. `fetchAllPageData()`でScrapbox APIから対象ページのメタ情報（`relatedPages`など）を取得します。
2. `relatedPages`から1hop、2hop、プロジェクトリンクを抽出します。
3. 全てのリンク先ページに対し、`fetchPage()`を使って本文を取得し、キャッシュ（`cache`オブジェクト）に格納します。
4. `ensureDialogExists()`でダイアログとチェックボックス、テキストエリアなどのUI要素を生成します。
5. 初回に全文字をキャッシュへロードした後、チェックボックスの変更時に`updateTextareaContent()`を呼び出し、キャッシュ済みテキストを組み合わせてテキストエリアに反映します。

## カスタマイズ
- チェックボックスやテキストエリアのサイズ、スタイルは適宜CSSやJavaScriptで変更可能です。
- Scrapbox APIの取得先や、表示文字列のフォーマット(`"## " + title + "\n" + text`)はお好みで調整できます。
- 他のフィルタリングやソート処理を行いたい場合、`updateTextareaContent()`内でキャッシュされた結果を適宜加工することが可能です。

## 参考
- [Scrapbox APIリファレンス](https://scrapbox.io/help-jp/API)  
- [Dialog要素 (MDN)](https://developer.mozilla.org/ja/docs/Web/HTML/Element/dialog)